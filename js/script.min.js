function IsFetched(e,l){let t=0;for(const l of e)if(!AllPrices.includes(l.UniqueName))for(let e=0;e<AllURLprices.length;e++){const a=AllURLprices[e].includes(l.UniqueName);a&&(console.log(AllURLprices[e]),fetchPrices(AllURLprices[e]),AllURLprices.splice(e,1),t++)}const a=t;let s=0;const o=()=>{console.log(s,a),s===a?(FunctionFinished=!0,console.log("All fetches are completed"),"Add"===l?waitForItAdd():"Update"===l&&waitForItUpdate()):setTimeout(o,500),s++};o()}function selectOnlyTier(e){return console.log("tier: ",e),AllDataTier=[],9!==e?(IsSortingByTiers=!0,ItemsAll.forEach(l=>{Tiers["T".concat(e)].hasOwnProperty(l.UniqueName)&&AllDataTier.push(l)})):(IsSortingByTiers=!1,AllDataTier=ItemsAll),AllDataTier.length<=currentItems?document.querySelector(".btn-afficher-plus").style.display="none":document.querySelector(".btn-afficher-plus").style.display="block",AllDataTier}function selectOnlyLevel(e){return console.log("level: ",e),AllDataLevel=[],5!==e&0!==e?(console.log("1level: ",e),IsSortingByLevels=!0,ItemsAll.forEach(l=>{l.UniqueName.includes("@".concat(e))&&AllDataLevel.push(l)})):5==e?(console.log("2level: ",e),IsSortingByLevels=!1,AllDataLevel=ItemsAll):(console.log("3level: ",e),IsSortingByLevels=!0,ItemsAll.forEach(e=>{e.UniqueName.includes("@")||AllDataLevel.push(e)})),console.log(AllDataLevel),AllDataLevel.length<=currentItems?document.querySelector(".btn-afficher-plus").style.display="none":document.querySelector(".btn-afficher-plus").style.display="block",AllDataLevel}function selectOnlyTierLevel(e,l){return console.log(e,l),AllDataTierLevel=[],null===l&&(l="All levels"===sortLevel?5:sortLevel),e=null===e?"All tiers"===sortTier?9:sortTier:"T".concat(e),console.log("Level est différent de 5 ? ",5!=l),console.log("Level est différent de 0 ? ",0!=l),console.log("Tier est différent de 'T9' ? ","T9"!=e),5!=l&&0!=l&&"T9"!=e?(console.log("La condition est vraie : ",e,l),IsSortingByLevels=!0,IsSortingByTiers=!0,AllDataTierLevel=[],ItemsAll.forEach(t=>{t.UniqueName.includes("@".concat(l))&Tiers[e].hasOwnProperty(t.UniqueName)&&AllDataTierLevel.push(t)})):5==l?(IsSortingByLevels=!1,console.log("2"),AllDataTierLevel=selectOnlyTier(e.slice(1,2))):0==l&"T9"!=e?(IsSortingByLevels=!0,console.log("0, 9 aaaaaaaa"),ItemsAll.forEach(l=>{!l.UniqueName.includes("@")&Tiers[e].hasOwnProperty(l.UniqueName)&&AllDataTierLevel.push(l)})):0==l&9==e?(IsSortingByLevels=!0,console.log("3"),ItemsAll.forEach(e=>{e.UniqueName.includes("@")||AllDataTierLevel.push(e)})):"T9"==e&&(IsSortingByTiers=!1,console.log("4"),AllDataTierLevel=selectOnlyLevel(l)),AllDataTierLevel.length<=currentItems?document.querySelector(".btn-afficher-plus").style.display="none":document.querySelector(".btn-afficher-plus").style.display="block",AllDataTierLevel}function isImgUrl(e){const l=new Image;return l.src=e,new Promise(e=>{l.onerror=(()=>e(!1)),l.onload=(()=>e(!0))})}function compareStrings(e,l){return e=e.toLowerCase(),l=l.toLowerCase(),"A to Z"===sortAZ?e<l?-1:e>l?1:0:e>l?-1:e<l?1:0}function sort(e,l){const t={};e.forEach(e=>{const l=e.Index;t[l]={LocalizationNameVariable:e.LocalizationNameVariable,LocalizationDescriptionVariable:e.LocalizationDescriptionVariable,LocalizedNames:e.LocalizedNames,LocalizedDescriptions:e.LocalizedDescriptions,Index:e.Index,UniqueName:e.UniqueName}}),l?AllData=Object.values(t).sort((e,l)=>e.LocalizedNames&&e.LocalizedNames[Language]&&l.LocalizedNames&&l.LocalizedNames[Language]?compareStrings(e.LocalizedNames[Language],l.LocalizedNames[Language]):0):AllDataSearch=Object.values(t).sort((e,l)=>e.LocalizedNames&&e.LocalizedNames[Language]&&l.LocalizedNames&&l.LocalizedNames[Language]?compareStrings(e.LocalizedNames[Language],l.LocalizedNames[Language]):0)}async function UpdateCards(){for(;0==AllPrices.length;)console.log("aaa"),await new Promise(e=>setTimeout(e,1e3));for(console.log("hello");ItemCardContainer.firstChild;)ItemCardContainer.removeChild(ItemCardContainer.firstChild);Items.forEach(e=>{const l=baseURLimage.concat(e.UniqueName);isImgUrl(l).then(t=>{if(t){const t=ItemCardTemplate.content.cloneNode(!0).children[0],a=t.querySelector("[data-header]"),s=t.querySelector("[data-image]"),o=t.querySelector(".prices"),r=t.querySelector(".quality");let n=1,c={},i=!0;for(;n<=5&&i;){const l=["Martlock","5003","Caerleon","Bridgewatch","Fort Sterling","Thetford","Lymhurst","black-market"];l.forEach(l=>{c[l.replace(/\s/g,"-").toLowerCase()]=AllPrices.flat().find(t=>t.city===l&&t.item_id===e.UniqueName&&t.quality===n),c[l.replace(/\s/g,"-").toLowerCase()]&&c[l.replace(/\s/g,"-").toLowerCase()].sell_price_min&&(i=!1)}),n++}if(i)r.textContent="No price found";else{const e=o.querySelectorAll("div[class]");e.forEach(e=>{const l=e.getAttribute("class");c[l]&&void 0!==c[l].sell_price_min&&0!==c[l].sell_price_min&&(e.textContent=c[l].sell_price_min)}),n--,r.textContent="Quality: ".concat(n)}const u=e.LocalizedNames[Language];a.textContent=u,"No price found"===r.textContent?s.src=l:s.src=l.concat("?quality="+n),ItemCardContainer.append(t)}})})}function getURL(e){fullURLprices="",DataToAddURLbefore=[],DataToAddURL=[];for(const l of DataToAdd.slice(e,DataToAdd.length)){if(DataToAddURL.push(l.UniqueName),fullURLprices=basURLPrices+DataToAddURL+baseURLPricesEnd,fullURLprices.length>=4096){fullURLprices=basURLPrices+DataToAddURLbefore+baseURLPricesEnd;break}DataAddedURL+=1,DataToAddURLbefore.push(l.UniqueName)}}async function fetchPrices(e){let l,t;await fetch(e,{mode:"cors"}).then(e=>(l=e.headers.get("content-encoding"),t=e.headers.get("x-rate-limit-remaining"),e.json())).then(e=>{AllPrices.push(e),console.log(l),console.log(t)}),console.log("Toutes les requêtes de prix ont été effectuées de manière progressive.")}function AddCards(e){console.log(e),e?(AllItems=AllData.slice(currentItems,currentItems+CardsPerPage).map((e,l)=>{Items.push(e)}),currentItems=Items.length):(AllDataSearch=searchItems(SearchValue),sort(AllDataSearch,!1),console.log(currentItemsSearch,currentItemsSearch+CardsPerPage),currentItemsSearch=Items.length,AllItems=AllDataSearch.slice(currentItemsSearch,currentItemsSearch+CardsPerPage).map((e,l)=>{Items.push(e)}),currentItemsSearch=Items.length),UpdateCards()}function searchItems(e){const l=AllData.filter(l=>{if(l.LocalizedNames){const t=e.toLowerCase().replace(/œ/g,"oe").split(" "),a=t.every(e=>l.LocalizedNames[Language].toLowerCase().replace(/œ/g,"oe").includes(e));return"All tiers"!==sortTier?a&&Tiers["T".concat(sortTier.slice(1,2))].hasOwnProperty(l.UniqueName):a}return!1});return l}async function GetTiers(){await fetch("https://aomp.vercel.app/TiersData.json").then(e=>e.json()).then(e=>{Tiers=e})}async function FetchData(){AllData=[],AllDataSearch="nothing",Items=[],currentItems=0,currentItemsSearch=0,await fetch("https://aomp.vercel.app/item.json").then(e=>e.json()).then(e=>{for(AllItems=e.slice(0,e.length).map((e,l)=>{e.LocalizedNames&&AllData.push(e)}),sort(AllData,!0),ItemsAll=AllData,DataToAdd=AllData;DataAddedURL<DataToAdd.length;)getURL(DataAddedURL),AllURLprices.push(fullURLprices);fetchPrices(AllURLprices[0]),AllURLprices.splice(0,1),"All tiers"!==sortTier&&(AllData=IsSortingByLevels?selectOnlyTierLevel(sortTier.slice(1,2),null):selectOnlyTier(sortTier.slice(1,2))),"All levels"!==sortLevel&&(IsSortingByTiers?AllData=selectOnlyTierLevel(null,sortLevel):(console.log("selectonlylevel"),AllData=selectOnlyLevel(sortLevel))),AddCards(!0)})}const ItemCardTemplate=document.querySelector("[data-item-template]"),ItemCardContainer=document.querySelector("[data-item-cards-container]"),SearchInput=document.querySelector("[data-search]"),CardsPerPage=100,baseURLimage="https://render.albiononline.com/v1/item/",baseURLimagefake="https://www.apyart.com/1904-large_default/rouge-pop-500ml.jpg",basURLPrices="https://west.albion-online-data.com/api/v2/stats/prices/",baseURLPricesEnd="?locations=martlock,5003,caerleon,bridgewatch,4002,thetford,lymhurst&qualities=0",SortMenuTextAZ=document.querySelector('li a[class="SortMenuTextAZ"]'),SortMenuTextT=document.querySelector('li a[class="SortMenuTextT"]'),SortMenuTextL=document.querySelector('li a[class="SortMenuTextL"]'),SortMenuTextLa=document.querySelector('li a[class="SortMenuTextLa"]'),SousMenuLa=document.querySelector('ul[class="SousMenuScrLa"]'),SousMenuL=document.querySelector('ul[class="SousMenuScrL"]'),SousMenuAZ=document.querySelector('ul[class="SousMenuScrAZ"]'),SousMenuT=document.querySelector('ul[class="SousMenuScrT"]'),NoResults=document.querySelector('[class="No-Results"]');let timeoutId,ItemsAll,SearchValue,scrollPosition,AllData=[],Tiers={},AllDataSearch="nothing",Items=[],AllDataTier=[],AllDataLevel=[],AllDataTierLevel=[],currentItems=0,currentItemsSearch=0,wasWriting=!1,sortAZ="A to Z",sortTier="All tiers",sortLevel="All levels",IsSortingByLevels=!1,IsSortingByTiers=!1,DataToAdd=[],fullURLprices="",AllURLprices=[],DataToAddURLbefore=[],DataToAddURL=[],DataAddedURL=0,AllPrices=[],Language=localStorage.getItem("language"),LanguageCool=localStorage.getItem("languageCool"),FunctionFinished=!1,completedFetches=0;GetTiers(),FetchData(),NoResults.style.display="none";